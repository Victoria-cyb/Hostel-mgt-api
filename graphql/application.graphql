enum ApplicationStatus {
  pending
  approved
  rejected
}

enum AllocationSource {
admin
parent
student
}

enum PaymentStatus {
pending
paid
}

# ========== APPLICATION ==========
type Application {
  id: ID!
  applicationNumber: String!
  student: User
  bed: Bed
  status: ApplicationStatus!
  amount: Float!
  currency: String!
  startDate: String
  endDate: String
  stayType: StayType
  academicSession: String
  academicTerm: String
  payments: [Payment!]!
  createdBy: AllocationSource!
  createdAt: String!
  updatedAt: String
 spaceUser: SpaceUser
 allocations: [Allocation!]!
}

# ========== PAYMENTS ==========
type Payment {
  id: ID!
  application: Application
  allocation: Allocation
  reference: String!
  amount: Float!
  currency: String!
  status: PaymentStatus!
  method: String
  createdAt: String!
  updatedAt: String
  authorizationUrl: String
}

# ========== INPUTS ==========
input ApplyInput {
  studentId: ID!
  bedId: ID!
  startDate: String
  endDate: String
  stayTypeId: ID
  amount: Float!
  currency: String!
  academicSession: String
  academicTerm: String
}

input ApplicationFilter {
  studentId: ID
  startDate: String
  endDate: String
  stayTypeId: ID
  hostelId: ID
  roomId: ID
  bedId: ID
  applicationNumber: String
}

# ========== APPLICATION QUERIES ==========
extend type Query {
  applications(filter: ApplicationFilter, spaceId: ID!): [Application!]! @auth @spaceAuth(requires: [admin])
  application(id: ID!, spaceId: ID!): Application @auth @spaceAuth(requires: [admin])
  payments(applicationNumber: String, allocationNumber: String, spaceId: ID!): [Payment!]! @auth @spaceAuth(requires: [admin])
  payment(id: ID!): Payment @auth @spaceAuth(requires: [admin])
}

# ========== APPLICATION MUTATIONS ==========
extend type Mutation {
  studentBook(input: ApplyInput!, spaceId: ID!): Application! @auth @spaceAuth(requires: [student])
  parentBulkBook(inputs: [ApplyInput!]!, spaceId: ID!): [Application!]! @auth @spaceAuth(requires: [parent])
  approveApplication(applicationId: ID!, spaceId: ID!): Allocation! @auth @spaceAuth(requires: [admin])
  payHostelFee(applicationNumber: String!, spaceId: ID!): Payment! @auth @spaceAuth(requires: [student, parent])
  recordPayment(applicationNumber: String!, status: PaymentStatus!, spaceId: ID!): Payment! @auth @spaceAuth(requires: [admin])
  verifyPayment(reference: String!, spaceId: ID!): Boolean! @auth @spaceAuth(requires: [admin])
}
