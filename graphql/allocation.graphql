enum AllocationStatus {
  reserved
  active
  holiday_leave
  checked_out
}

# ========== ALLOCATION ==========
type Allocation {
  id: ID!
  allocationNumber: String!
  spaceUser: SpaceUser
  bed: Bed
  status: AllocationStatus!
  startDate: String
  endDate: String
  stayType: StayType
  academicSession: String
  academicTerm: String
  checkInDate: String
  checkOutDate: String
  application: Application
  payments: [Payment!]
  createdBy: AllocationSource!
  createdAt: String!
}

# ========== INPUTS ==========
input AllocationFilter {
  studentId: ID
  startDate: String
  endDate: String
  stayTypeId: ID
  hostelId: ID
  roomId: ID
  bedId: ID
  allocationNumber: String
}

# ========== ALLOCATION QUERIES ==========
extend type Query {
  allocations(filter: AllocationFilter, spaceId: ID!): [Allocation!]!
    @auth
    @spaceAuth(requires: [admin])
  allocation(id: ID!, spaceId: ID!): Allocation
    @auth
    @spaceAuth(requires: [admin])
}

# ========== ALLOCATION MUTATIONS ==========
extend type Mutation {
  adminBulkAllocate(inputs: [ApplyInput!]!, spaceId: ID!): [Allocation!]!
    @auth
    @spaceAuth(requires: [admin])
  checkIn(allocationId: ID!, spaceId: ID!): Boolean!
    @auth
    @spaceAuth(requires: [admin, student])
  checkOut(allocationId: ID!, spaceId: ID!): Boolean!
    @auth
    @spaceAuth(requires: [admin, student])
  markLeave(
    allocationId: ID!
    reason: String!
    signOutDate: String!
    expectedReturn: String!
    spaceId: ID!
  ): Allocation! @auth @spaceAuth(requires: [admin, student])
}
